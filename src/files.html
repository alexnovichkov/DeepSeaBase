<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <META name="description" content="DeepSea Base"/>
  <title>DeepSea Base - просмотрщик спектров</title>
  <link href="style.css" rel="stylesheet" type="text/css"/>
  <script  type="application/javascript" src="version.js"></script>
</head>
<body class="left-sidebar">
  <div id="wrapper">
    <div id="content">
      <div id="content-inner">
        <article class="is-post">
          <header>
            <h1>DeepSea Base <script type="application/javascript">version();</script></h1>
            <span class="byline">Работа с записями и каналами</span>
          </header>
          
          <p>DeepSea Base поддерживает работу с файлами следующих типов:</p>
          <ul>
            <li><img src="icons/dfd.svg"/> Файлы DeepSea (*.dfd + *.raw)</li>
            <li><img src="icons/uff.svg"/> Файлы Universal File Format текстового формата (*.uff)</li>
            <li><img src="icons/d94.svg"/> Файлы Data94 (*.d94) - двоичный формат, специально разработанный для использования в DeepSea Base. Он позволяет сохранять данные разного формата - временные реализации, комплексные спектры, время-частотные характеристики, октавные спектры и т.д. Описание формата смотри <a href="#data94">здесь</a>.</li>
            <li><img src="icons/wav.svg"/> Файлы Wave (*.wav). DeepSea Base поддерживает чтение и конвертацию файлов этого типа, но не поддерживает их изменение.</li>
            <li><img src="icons/anp.svg"/> Файлы ANP (*.anp + *.ana). DeepSea Base поддерживает чтение и конвертацию файлов этого типа, но не поддерживает их изменение.</li>
          </ul>

          <h3>Добавление и удаление записей</h3>
          <p><strong>Добавить</strong> записи в базу можно как в текущую вкладку, так и в новую. Можно добавлять:</p>
          <ul>
            <li>Записи из папки (<span class=hotkey>Ctrl+O</span>)</li>
            <li>Записи из папки и всех вложенных в нее папок</li>
            <li>Файлы по одному / по нескольку</li>
          </ul>
          <p>Добавлять записи в базу можно также перетаскиванием файлов из проводника.</p>
          <p>Добавленные файлы или папки будут восстановлены после закрытия программы.</p>
          <p>Чтобы <strong>удалить</strong> запись/записи, выделите ее/их в таблице записей 
            и нажмите <span class=hotkey>Del</span>.</p>

          <p>Добавленные пути (отдельные файлы и папки) можно просмотреть, нажав правой кнопкой мыши на заголовке вкладки и выбрав пункт "Отслеживаемые файлы и папки". Откроется диалоговое окно, в котором отображаются все добавленные во вкладку записи. Отдельные пути можно удалить, выделив их в таблице и нажав Del или кнопку "Убрать из отслеживаемых".  </p>

          <h3>Сортировка и фильтрация записей</h3>
          <p>Программа поддерживает сортировку записей по любому столбцу. Сортировка численных столбцов и столбца даты/времени 
          учитывает значения, а не их текстовые представления (правильная сортировка чисел).</p>

          <p>Кнопка <img src="icons/funnel.png"/> в таблице записей позволяет фильтровать записи. Использование нескольких полей позволяет осуществлять каскадную фильтрацию (например, по двум столбцам).</p>

          <h3>Изменение информации о записях</h3>

          <p>Для редактирования доступны следующие поля в таблице записей:</p>
          <ul>
              <li>Дата и время создания записи</li>
              <li>Шаг - шаг по оси X</li>
              <li>Описание - описатель записи</li>
              <li>Легенда - дополнительная информация о записи, отображаемая в легенде графиков</li>
          </ul>
          <p>Чтобы их изменить, необходимо дважды щелкнуть по нужной ячейке в таблице записей.</p>
          <h4>Редактирование описателей</h4>
          <p>Чтобы изменить описание записи, нужно нажать кнопку <img src="icons/descriptor.png"/>. Откроется диалоговое окно, в левой части которого отображаются выделенные записи, а в правой - описатели для выбранной записи.</p>
          <p>Описатели записи - это обычные строки вида "ключ=значение", которые можно свободно редактировать, удалять или добавлять собственные.</p>
          <p>Для редактирования описателей выберите нужный файл слева, затем во второй вкладке справа измените, удалите или добавьте нужные описатели.</p>
          <p>Замечание: Файлы UFF поддерживают сохранение только двух строк описателей, все остальные будут удалены при сохранении файла.</p>

          <h3>Изменение каналов в записях</h3> 
          <h4>Изменение информации о каналах</h4>
          <p>Для редактирования доступны следующие поля в таблице каналов:</p>
          <ul>
              <li>Имя - название канала</li>
              <li>Ед.изм. - единица измерения по оси Y</li>
              <li>Описание канала</li>
          </ul>
          <p>Все остальные поля отображаются как неактивные.</p>
          <p>Для ускорения редактирования существует возможность записать измененное значение сразу в несколько
           записей. Для этого необходимо выделить нужные записи в таблице записей, изменить значение (название канала, 
           единицу измерения или описание) и нажать 
          <span class=hotkey>Enter</span>. Появится диалоговое окно с вопросом "Записать такой параметр во все эти файлы?".</p>
          <p><b>Дополнительные свойства</b> каналов можно изменить в диалоге "Свойства каналов", который можно открыть кнопкой <img src="icons/descriptor.png"/>. Этот диалог также предоставляет сведения о параметрах расчета канала (вкладка "Функция").</p>

          <h4>Удаление каналов</h4>
          <p>Выделите каналы, которые вы хотите удалить. Затем нажмите кнопку <img src="icons/remove.png"/>.</p>
          <p>Выпадающее меню в этой кнопке позволяет удалять каналы сразу из нескольких файлов. 
          Для этого в левой таблице файлов выделите требуемые файлы, выделите ненужные каналы 
          и выберите пункт меню "Удалить каналы в нескольких файлах".</p> 

          <h4>Перемещение и копирование каналов</h4>
          <p>Можно перемещать каналы в пределах файла вверх/вниз и даже в начало или в конец файла. Для этого достаточно выделить каналы, которые необходимо сдвинуть (можно не строить графики, это сэкономит время и память), и комбинациями <span class=hotkey>Ctrl+↑</span> и <span class=hotkey>Ctrl+↓</span> сдвигать выделенные каналы на нужное число позиций.</p>
          <p>Перемещение каналов в другую запись доступно двумя способами: из одной записи без построения графиков и из разных записей, построив графики нужных каналов. Можно копировать/перемещать каналы как в имеющийся файл, так и в новый файл (в этом случае он будет добавлен в таблицу записей).</p>
          <p>Копирование/перемещение каналов из файлов разного типа или с разным шагом по оси X невозможно для файлов DFD.</p>
          <p><strong>Копирование/перемещение из одной записи</strong>: Выделите каналы, которые вы хотите скопировать/переместить (графики можно не строить, это сэкономит время и память). Затем щелкните одну из иконок 
            <img src="icons/channel-copy.png"/> Копировать выделенные каналы в файл...</strong> / 
             <img src="icons/channel-cut.png"/> Переместить выделенные каналы в файл...</strong>.</p>
          <p><strong>Копирование/перемещение из разных записей</strong>: Постройте графики каналов, которые вы хотите скопировать/переместить. Затем щелкните одну из иконок 
            <img src="icons/channel-copy-plotted.png"/> Копировать построенные каналы в файл...</strong> / 
             <img src="icons/channel-cut-plotted.png"/> Переместить построенные каналы в файл...</strong>.</p>   

        <h3>Изменение данных</h3>
        <h4>Добавление поправок</h4>
        <p>Под добавлением поправок к записям подразумевается изменение значений всех дискрет канала на одинаковую величину 
        (или одинаковый множитель).</p>
        <p>Диалоговое окно поправок можно открыть нажатием кнопки <img src="icons/correction.png">. Чтобы внести поправки, необходимо:</p> 
        <ol>
            <li>Построить графики тех каналов, в которые планируется вносить поправки.</li>
            <li>Выбрать формат оси Y в контекстном меню вертикальной оси.
            <ul>
                <li>Чаще всего необходимо вносить поправки в децибелах, для этого графики каналов должны быть построены
                в логарифмической шкале. Выберите пункт меню "Показывать как → Амплитуды в дБ".</li>
                <li>Поправки можно вносить и в файлы с временными реализациями (в виде множителя). При этом формат оси Y
                выставите в "Показывать как → Действит."</li>
            </ul>
            </li>
            <li>Открыть диалоговое окно поправок кнопкой <img src="icons/correction.png"> в панели "Каналы:".</li>
            <li>Выделить те каналы, в которые необходимо внести поправку. Выделять можно ячейки в любых столбцах.</li>
            <li>Ввести значение поправки. Допускается использовать любой разделитель дробной части.</li>
            <li>Выбрать тип поправки: Слагаемое / Множитель.</li>
            <li>Нажать кнопку "Скорректировать".</li>
            <li>Повторить этапы 4-7 для других каналов.</li>
            <li>Если введенные поправки устраивают, закрыть диалог поправок, нажав кнопку "Закрыть и сохранить поправку в
            файл данных". Если поправки не устраивают, закрыть диалог кнопкой "Закрыть без сохранения".</li>
        </ol>
        <p>При сохранении поправки величина введенной поправки применяется к данным канала, сохраняется в файле описателей каналов и отображается в виде суффикса к названию графика. Например, при добавлении поправки +5 дБ: "Лопасть 1.5/Сила1[+5]."</p>
        <p>Если поправка была сохранена в файл данных, то отменить внесение поправки нельзя. Можно лишь внести новую поправку 
        с противоположным знаком (или с обратным значением).</p>
        <h4>Пакетное внесение поправок</h4>
        <p>Существует два способа  разом внести поправки к нескольким записям.</p>
        <p><b>Первый способ</b> - воспользоваться диалоговым окном поправок.</p>
        <p>Для этого необходимо:</p>
        <ol>
            <li>Выделить записи в таблице записей, в которые требуется внести поправки.</li>
            <li>Построить графики тех каналов <u>последнего выделенного файла</u>, в которые планируется вносить поправки.</li>
            <li>Открыть диалоговое окно поправок кнопкой <img src="icons/correction.png"> в панели "Каналы:".</li>
            <li>Отметить галочкой опцию "Применить поправку ко всем выделенным файлам".</li>
            <li>Выделить те каналы, в которые необходимо внести поправку.</li>
            <li>Ввести значение поправки. Допускается использовать любой разделитель дробной части.</li>
            <li>Выбрать тип поправки: Слагаемое / Множитель.</li>
            <li>Нажать кнопку "Скорректировать". При этом, если отмечена опция "Применить поправку ко всем
            выделенным файлам", то поправка будет применена ко всем выделенным записям,
            имеющим канал с выбранным номером.</li>
            <li>Повторить этапы 5-8 для других каналов.</li>
        </ol>
        <p>Внимание: если отметить опцию "Применить поправку ко всем выделенным файлам" только перед сохранением файла,
        то поправки сохранятся только в текущий файл.</p>
        <p><b>Второй способ</b> - импортировать поправки из таблицы Excel.</p>
        <p>Этим способом можно ввести только поправку-слагаемое.</p>
        <p>Для этого необходимо:</p>
        <ol>
            <li>Подготовить и сохранить файл XLS (или XSLX) с таблицей поправок следующего формата:
                <ul>
                    <li>Первая строка: названия файлов (с путем к ним), в которые вносятся поправки.</li>
                    <li>Вторая строка: величина поправки для канала 1.</li>
                    <li>Третья строка: величина поправки для канала 2.</li>
                    <li>И так далее для каждого канала в записи.</li>
                </ul>
                <p>Лист при сохранении должен быть активным (текущим).</p>
            </li>
            <li>Нажать кнопку "Добавить поправки из файла..." в выпадающем меню кнопки <img src="icons/correction.png">.</li>
            <li>Выбрать файл с поправками и нажать кнопку "Открыть".</li>
            <li>Дождаться окончания работы программы. Нажать кнопку "Готово!".</li>
        </ol>
        <h3>Воспроизведение временных данных</h3>
        <p>В программе существует возможность прослушать построенный канал временных реализаций как если бы это был файл WAV. Для этого:</p>
        <ol>
            <li>Постройте кривые каналов, которые хотите прослушать.</li>
            <li>На панели инструментов графика в выпадающем списке выберите нужный канал.</li>
            <li>Нажмите кнопку <img src="icons/play.png"></li>
        </ol>
        <p>При воспроизведении вертикальный курсор зеленого цвета отмечает текущее положение. Курсор можно передвигать вручную, перетаскивая его на нужную позицию, а можно двойным щелчком левой кнопкой мыши внутри графика установить в нужное положение.</p>
        <p>При воспроизведении каналов положение курсора запоминается.</p>

        <h3>Экспорт записей в WAV</h3>
        <p>Записи, содержащие временные реализации, можно экспортировать в формат WAV. Для этого:</p>
        <ol>
          <li>Выделите каналы, которые нужно экспортировать (графики строить необязательно).</li>
          <li>Нажмите кнопку <img src="icons/wav.ico">.</li>
          <li>В диалоге экспорта задайте:
          <ul>
            <li>Количество каналов на один файл</li>
            <li>Формат файла - PCM 16 bit / IEEE-float 32 bit</li>
          </ul></li>
          <li>Нажмите OK</li>
        </ol>


        <h3><a name="data94"></a>Файлы Data94</h3>
        <p>Расширение - d94.</p>
        <p>Тип - двоичный. Целочисленные значения хранятся в формате uint32 (4 байта), вещественные - в формате float
        (4 байта) или double (8 байтов). В файле предусмотрена возможность хранить комплексные данные.</p>
        <p>Описание файла и каналов хранится в текстовом формате JSON и записывается непосредственно в файл. Файл Data94 можно открыть в текстовом редакторе 
        и скопировать / посмотреть нужную информацию.</p>
        <p>Все каналы абсолютно независимы друг от друга. Это означает, что соседние каналы могут различаться количеством 
        сэмплов, форматом данных, количеством блоков, точностью представления.</p>
        <p>Файл Data94 позволяет хранить несколько блоков данных для канала, что удобно использовать,
        например, для время-частотных характеристик. Блоки описываются как ось Z.</p>
        <h4>Структура файла</h4>
        <p><img src="icons/data94.png"></p>
        <ul>
          <li><b>dsize</b> - длина описания файла (в формате JSON) в байтах</li>
          <li><b>количество каналов</b> записывается в формате uint32</li>
          <li><b>c1_size</b>, c2_size и т.д. - длина описания канала 1, 2 и т.д., в байтах</li>
          <li><p><b>Блоки описания осей</b> X и Z имеют одинаковый формат (см. рисунок). Они позволяют задать равномерную или неравномерную шкалу, начало шкалы, количество отсчетов, шаг по оси в случае равномерной шкалы или значения по оси в случае неравномерной шкалы.</p>
            <p>Ось X задает количество отсчетов на один блок, начальное значение и шаг по оси в случае равномерной шкалы, или список значений в случае неравномерной шкалы (например, для третьоктавного спектра). Пример равномерной шкалы: uniform=1, xcount=800, xbegin=0.0, xstep=2.0 (равномерная шкала, 800 отсчетов, диапазон 0-1600 Гц). Пример неравномерной шкалы: uniform=0, xcount=36, 1.0, 1.26, 1.6, 2.0, 2.5, ...(всего 36 значений в формате float).</p>
            <p>Ось Z нужна, чтобы задать многоблочные данные, например, неусредненные данные для спектрограммы. В этом случае каждый блок будет содержать xcount отсчетов. Например, блок описания оси Z может выглядеть так: uniform=1, zcount=75, zbegin=0.0, zstep=8.0 (исходный временной файл имел длину 75*8=600 секунд, при расчете спектра брались блоки по 8 секунд).</p>
            <p>Если канал содержит только один блок (обычный усредненный спектр или временные данные), то в блоке описания оси Z следует задать такие значения: uniform=1, zcount=1, zbegin=0.0, zstep=0.0.</p></li>

          <li>Блок описания оси - параметр <b>uniform</b> может принимать значение 1 (равномерная шкала) или 0 (неравномерная шкала)</li>
          <li>Блок описания оси - параметр <b>count</b> количество отсчетов по данной оси, в формате uint32</li>
          <li>Блок описания оси - данные для неравномерной шкалы записываются в формате float (4 байта)</li>
          <li><b>format</b> - может принимать значения 1 (действительные данные) или 2 (комплексные данные)</li>
          <li><b>width</b> - может принимать значения 1 (int8 или uint8), 2 (int16 или uint16), 4 (int32, uint32 или float) или 8 (int64, uint64 или double). Это не позволяет определить, в каком именно формате записаны данные (4 байта может быть как float, так и int32), поэтому точный формат задается дополнительно в описании канала параметром precision (см. ниже). Если этот параметр отсутствует, то подразумевается, что width=1 соответствует int8, width=2 соответствует int16, width=4 соответствует float, width=8 соответствует double.</li>

        </ul>
        <h4>Описание файла и каналов</h4>
        <p>Описание файла включает следующие поля:</p>
        <code><pre>
{
    "dateTime" : "dd.MM.yyyy hh:mm", //дата и время создания базы данных
    "fileCreationTime": "dd.MM.yyyy hh:mm", //дата и время создания этого файла
    "createdBy": "", //программа, которая записала файл
    "legend" : "", // легенда записи
    "description": {
        //аналогично DFD DataDescription
        "режим" : "белый шум",
        "диапазон" : "3200 Гц"
    },
    "guid": "", // GUID записи, аналогичный GUID файлов DFD
    "source": { 
      "file": "", // файл-источник 
      "guid": "", // GUID файла-источника
      "dateTime": "dd.MM.yyyy hh:mm", // дата и время создания файла-источника
      "channels": "1,2,3,4,5" // каналы источника, использованные в этом файле
    }
}
</pre></code>
        <p>Описание канала включает следующие поля:</p>
        <code><pre>
{
    "name" : "", //название канала
    "description": "", // описание канала
    "correction": "", //величина коррекции
    "dateTime": "dd.MM.yyyy hh:mm", // дата и время создания канала, используется в uff
    "yname" : "m/s^2", // единица измерения по оси Y
    "ynameold": "V", // единица измерения по оси Y, испольуется при пересчете 
                     // единиц в дБ и обратно, если yname = "дБ"
    "xname" : "Hz", // единица измерения по оси X
    "zname" : "s", // единица измерения по оси Z

    "samples": 3200, //количество отсчетов на один блок
    "blocks": 1, // количество блоков, соответствующих отдельным значениям по Z
    "sensorID" : "", // ID канала или ChanAddress
    "sensorName": "", // название датчика 
    "samplerate": 8192, // частота дискретизации
    "bandwidth": 3200, // обычно samplerate/2.56, но может и отличаться при 
                       // полосовой фильтрации
    "function": { // эти значения описывают параметры функции, которая была применена 
                  // при расчете канала
        "name": "FRF", // название функции - для тонкой настройки типа функции
        "type": 5, //тип функции согласно UFF - обобщенный тип
        "description": "H1", // дополнительное описание функции
        "logref": 0.000314, // пороговое значение для перевода в дБ
        "logscale": "linear" / "quadratic" / "dimensionless", 
        "responseName": "lop1:1", // название канала отклика
        "responseDirection": "+z", // направление датчика в канале отклика
        "responseNode": "", // название узла, в котором стоял датчик
        "referenceName": "lop1:1", // название опорного канала 
        "referenceNode": "", // название опорного узла 
        "referenceDescription": "более полное описание из dfd",
        "referenceDirection": "",
        "format": "real", "imaginary", "complex", "amplitude", "phase", "amplitudeDb"
                  // описание формата данных
        "precision": "int8" / "uint8" / "int16" / "uint16" / "int32" / "uint32" 
                    / "int64" / "uint64" / "float" / "double"
                    // описание формата отсчета
        "octaveFormat" : 0 (default) / 1 / 3 / 2 / 6 / 12 / 24, // октавный формат
        //далее идут все параметры обработки
        "weighting": "no" / "A" / "B" / "C" / "D"
        "averaging": "linear", "no", "exponential", "peak hold", "energetic"
        "averagingCount": 38,
        "window": "Hanning" / "Hamming" / "square" / "triangular" / "Gauss" / "Natoll" /
                  "force" / "exponential" / "Tukey" / "flattop" / "Bartlett" / 
                  "Welch symmetric" / "Welch periodic" / "Hanning broad" / "impact" / 
                  "Kaiser-Bessel",
        "windowParameter": 0.00,
        "blockSize": 2048,
        "channels": "1,2,3,4,5",
        // не все параметры обработки указаны здесь
    }
}</pre></code>
        </article>
   </div>
 </div>
 <div id="sidebar">
  <div id="logo">
    <h1>DeepSea Base</h1>
  </div>

  <nav id="nav">
    <ul>
      <li><a href="help.html" TARGET="_top">Что нового?</a></li>
      <li><a href="graphs.html" TARGET="_top">Графики</a></li>
      <li class="current_page_item"><a href="files.html" TARGET="_top">Записи</a></li>
      <li><a href="calculations.html" TARGET="_top">Расчеты в программе</a></li>
      <li><a href="convertation.html" TARGET="_top">Конвертация файлов</a></li>
    </ul>
  </nav>

  <section class="is-text-style1">
    <div class="inner">
      <p><center>
        Программа создана <br/>для нужд бюро 94.41 <br/>Алексеем Новичковым.
      </center></p>
    </div>
  </section>

  <div id="copyright">
    <p>&copy; 2014-2023</p>
  </div>
</div> <!-- sidebar -->
</div>
</body>
</html>
